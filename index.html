<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TB-CONTROL CLEAN</title>
    <style>
        :root {
            --primary-dark: #0A2E26;
            --bg-gray: #F4F7F6;
            --card-white: #ffffff;
            --text-gray: #718096;
            --accent-green: #0A6A5E;
            --accent-blue: #2B6CB0;
            --accent-red: #C53030;
            --accent-orange: #C05621;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: sans-serif; }
        body { margin: 0; background: var(--bg-gray); color: #2D3748; }

        header { 
            background: var(--primary-dark); padding: 15px 20px; 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
        }
        .app-title { color: white; font-weight: 800; font-size: 18px; }
        
        .search-box { 
            background: rgba(255,255,255,0.1); border-radius: 12px; 
            display: flex; align-items: center; padding: 5px 15px; width: 60%; 
        }
        .search-box input { 
            background: transparent; border: none; color: white; width: 100%; 
            outline: none; font-size: 14px; 
        }

        .section-title { padding: 20px 20px 5px; font-size: 11px; font-weight: 900; color: #A0AEC0; text-transform: uppercase; }
        
        /* Dashboard Grid 2x2 */
        .db-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px 20px; }
        .db-card { 
            background: white; border-radius: 15px; padding: 18px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.02); border-bottom: 5px solid #DDD;
        }
        .db-card h3 { margin: 0; font-size: 10px; color: var(--text-gray); text-transform: uppercase; }
        .db-val { font-size: 28px; font-weight: 900; margin: 5px 0; color: #1A202C; }
        
        .c-1 { border-color: var(--accent-green); }
        .c-2 { border-color: var(--accent-blue); }
        .c-3 { border-color: var(--accent-red); }
        .c-4 { border-color: var(--accent-orange); }

        /* Lista */
        .lista { padding: 5px 20px 100px; }
        .p-item { 
            background: white; border-radius: 18px; padding: 20px; 
            margin-bottom: 15px; border: 1px solid #EDF2F7;
        }
        .p-name { font-size: 18px; font-weight: 800; margin: 8px 0; }
        .tag { font-size: 10px; padding: 4px 10px; border-radius: 6px; color: white; font-weight: bold; margin-right: 5px; }

        /* Botão Novo Paciente (Estilo Imagem) */
        .btn-add {
            position: fixed; bottom: 30px; right: 25px; width: 65px; height: 65px;
            background: white; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            z-index: 2000; border: none; cursor: pointer;
        }
        .btn-add span { font-size: 35px; color: var(--accent-green); font-weight: 200; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 3000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); }
        .modal-content { background: white; margin: 10% auto; padding: 25px; width: 90%; border-radius: 25px; }
        input, select { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #E2E8F0; border-radius: 12px; }
        .btn-save { width: 100%; padding: 16px; background: var(--accent-green); color: white; border: none; border-radius: 12px; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <div class="app-title">TB-CONTROL</div>
    <div class="search-box">
        <input type="text" id="busca" placeholder="Pesquisar..." onkeyup="renderizar()">
    </div>
</header>

<div class="section-title">Resumo Clínico</div>
<div class="db-grid">
    <div class="db-card c-1"><h3>Ativos</h3><div class="db-val" id="at">0</div></div>
    <div class="db-card c-2"><h3>Curados</h3><div class="db-val" id="cu">0</div></div>
    <div class="db-card c-3"><h3>Abandono</h3><div class="db-val" id="ab">0</div></div>
    <div class="db-card c-4"><h3>HIV+</h3><div class="db-val" id="hi">0</div></div>
</div>

<div class="section-title">Pacientes Registados</div>
<div id="lista" class="lista"></div>

<button class="btn-add" onclick="abrir()"><span>+</span></button>

<div id="modal" class="modal">
    <div class="modal-content">
        <h2 style="margin:0 0 20px 0">Novo Paciente</h2>
        <input type="text" id="nid" placeholder="NID">
        <input type="text" id="nome" placeholder="Nome Completo">
        <select id="tipo"><option value="Sensível">TB Sensível</option><option value="Resistente">TB Resistente</option></select>
        <select id="hiv"><option value="Negativo">HIV Negativo</option><option value="Positivo">HIV Positivo</option></select>
        <button class="btn-save" onclick="salvar()">GRAVAR</button>
        <button onclick="fechar()" style="width:100%; background:none; border:none; color:gray; margin-top:15px;">Cancelar</button>
    </div>
</div>

<script>
    let dados = JSON.parse(localStorage.getItem('tb_final_v1')) || [];

    function abrir() { document.getElementById('modal').style.display='block'; }
    function fechar() { document.getElementById('modal').style.display='none'; }

    function salvar() {
        const p = {
            id: Date.now(),
            nid: document.getElementById('nid').value,
            nome: document.getElementById('nome').value,
            tipo: document.getElementById('tipo').value,
            hiv: document.getElementById('hiv').value,
            estado: 'Ativo'
        };
        if(!p.nome || !p.nid) return alert("Preencha os dados!");
        dados.push(p);
        localStorage.setItem('tb_final_v1', JSON.stringify(dados));
        fechar();
        renderizar();
    }

    function renderizar() {
        const lista = document.getElementById('lista');
        const busca = document.getElementById('busca').value.toLowerCase();
        lista.innerHTML = '';
        
        let at=0, cu=0, ab=0, hi=0;

        dados.filter(x => x.nome.toLowerCase().includes(busca)).forEach(p => {
            if(p.estado === 'Ativo') at++;
            if(p.hiv === 'Positivo') hi++;
            
            lista.innerHTML += `
                <div class="p-item">
                    <div style="font-size:11px; color:gray; font-weight:bold">NID: ${p.nid}</div>
                    <div class="p-name">${p.nome}</div>
                    <div>
                        <span class="tag" style="background:var(--accent-green)">${p.tipo}</span>
                        <span class="tag" style="background:var(--accent-orange)">HIV: ${p.hiv}</span>
                    </div>
                </div>
            `;
        });
        document.getElementById('at').innerText = at;
        document.getElementById('hi').innerText = hi;
    }
    renderizar();
</script>
</body>
</html>
